(()=>{"use strict";function e(e,o){var r=e.querySelector(o.formSelector),c=Array.from(r.querySelectorAll(o.inputSelector)),a=r.querySelector(o.submitButtonSelector);c.forEach((function(e){t(r,e,o)})),n(c,a,o)}var t=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""};function n(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}var o={baseUrl:"https://nomoreparties.co/v1/plus-cohort7",headers:{authorization:"9efb02c5-3a98-4492-ad54-7eb38e1b2fa2","Content-Type":"application/json"}},r={formSelector:".popup__form",inputSelector:".popup__input-text",submitButtonSelector:".popup__save",inactiveButtonClass:"popup__save_inactive",inputErrorClass:"popup__input-text_type_error",errorClass:"popup__input-error_active"},c=document.querySelector("#profile-edit-form"),a=c.querySelector("#profile-name-input"),u=c.querySelector("#profile-bio-input"),i=document.querySelector(".profile__name"),l=document.querySelector(".profile__bio"),s=document.querySelector(".profile__image"),d=document.querySelector("#avatar-edit-form"),f=document.querySelector("#card-add-popup"),p=f.querySelector("#card-place-input"),m=f.querySelector("#card-url-input"),v=document.querySelectorAll(".popup"),y=fetch("".concat(o.baseUrl,"/users/me"),{headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка при получении данных пользователя: ".concat(e.status))})),_=document.querySelector("#profile-name-input"),h=document.querySelector("#profile-bio-input"),S=document.querySelector("#profile-edit-popup"),q=document.querySelector("#card-add-popup"),k=document.querySelector("#image-popup"),g=document.querySelector("#avatar-edit-popup"),b=document.querySelector("#avatar-link-input"),E=k.querySelector(".popup__image"),L=k.querySelector(".popup__caption");function C(e){E.src=e.target.src,E.alt=e.target.alt,L.textContent=e.target.alt,x(k),k.style.background="rgba(0, 0, 0, 0.9)"}function x(e){e.classList.add("popup_opened"),e.style.opacity=1,function(e){window.addEventListener("keydown",B),e.addEventListener("click",P)}(e)}function j(){var e,t=function(){var e;return v.forEach((function(t){t.classList.contains("popup_opened")&&(e=t)})),e}();e=t,window.removeEventListener("keydown",B),e.removeEventListener("click",P),t.classList.remove("popup_opened"),t.style.opacity=.3}function B(e){"Escape"===e.key&&j()}function P(e){e.target.classList.contains("popup")&&j(),e.target.classList.contains("popup__close")&&j()}function w(e,t,n){var o=e.querySelector(".popup__save");if(t){var r=o.textContent;return o.textContent="Сохранение...",r}o.textContent=n}var A,U=document.querySelector(".elements");function T(e){U.prepend(function(e){var t=document.querySelector(".element-template").content.querySelector(".element").cloneNode(!0);return y.then((function(n){t.querySelector(".element__name").textContent=e.name,t.querySelector(".element__image").alt=e.name,t.querySelector(".element__image").src=e.link,t.querySelector(".element__like-count").textContent=e.likes.length,t.querySelector(".element__like").addEventListener("click",N),t.querySelector(".element__delete").addEventListener("click",D),t.querySelector(".element__image").addEventListener("click",C),t.dataset._id=e._id,e.owner._id===n._id&&t.querySelector(".element__delete").classList.add("element__delete_active"),e.likes.some((function(e){return e._id===n._id}))?(M(t),t.dataset.likedByMe=!0):t.dataset.likedByMe=!1})).catch((function(e){console.log(e)})),t}(e))}function D(e){var t;(t=e.target.closest(".element").dataset._id,fetch("".concat(o.baseUrl,"/cards/").concat(t),{headers:o.headers,method:"DELETE"}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка при удалении карты: ".concat(e.status))}))).then((function(){e.target.closest(".element").remove()})).catch((function(e){console.log(e)}))}function M(e){e.querySelector(".element__like").classList.toggle("element__like_active")}function N(e){var t=e.target.closest(".element"),n=t.dataset._id,r=function(e){return JSON.parse(e.dataset.likedByMe)?"DELETE":"PUT"}(t);(function(e,t){return fetch("".concat(o.baseUrl,"/cards/likes/").concat(e),{headers:o.headers,method:t}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка при постановке лайка: ".concat(e.status))}))})(n,r).then((function(e){t.querySelector(".element__like-count").textContent=e.likes.length,t.dataset.likedByMe=!JSON.parse(t.dataset.likedByMe),M(t)})).catch((function(e){console.log(e)}))}window.addEventListener("load",(function(){setTimeout((function(){for(var e=0;e<v.length;e++)v[e].style.display="flex"}),1e3)})),y.then((function(e){i.textContent=e.name,l.textContent=e.about,s.src=e.avatar,s.alt=e.name})).catch((function(e){console.log(e)})),c.addEventListener("submit",(function(e){e.preventDefault();var t={name:a.value,about:u.value},n=w(S,!0);(function(e){return fetch("".concat(o.baseUrl,"/users/me"),{headers:o.headers,method:"PATCH",body:JSON.stringify(e)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка при обновлении профиля: ".concat(e.status))}))})(t).then((function(e){i.textContent=e.name,l.textContent=e.about})).catch((function(e){console.log(e)})).finally((function(){j(),w(S,!1,n)}))})),f.addEventListener("submit",(function(e){e.preventDefault();var t={name:p.value,link:m.value},n=w(q,!0);(function(e){return fetch("".concat(o.baseUrl,"/cards"),{headers:o.headers,method:"POST",body:JSON.stringify(e)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка при загрузке карточки: ".concat(e.status))}))})(t).then((function(e){T(e)})).catch((function(e){console.log(e)})).finally((function(){p.value="",m.value="",j(),w(q,!1,n)}))})),d.addEventListener("submit",(function(e){e.preventDefault();var t=b.value,n=w(g,!0);(function(e){return fetch("".concat(o.baseUrl,"/users/me/avatar"),{headers:o.headers,method:"PATCH",body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка при обновлении профиля: ".concat(e.status))}))})(t).then((function(e){s.src=e.avatar})).catch((function(e){console.log(e)})).finally((function(){j(),w(g,!1,n)}))})),fetch("".concat(o.baseUrl,"/cards"),{headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка при загрузке карточек: ".concat(e.status))})).then((function(e){e.forEach((function(e){T(e)}))})).catch((function(e){console.log(e)})),document.querySelector(".profile__add").addEventListener("click",(function(){p.value="",m.value="",e(q,r),x(q)})),document.querySelector(".profile__edit").addEventListener("click",(function(){_.value=i.textContent,h.value=l.textContent,e(S,r),x(S)})),document.querySelector(".profile__avatar").addEventListener("click",(function(){b.value="",e(g,r),x(g)})),A=r,Array.from(document.querySelectorAll(A.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,o){var r=Array.from(e.querySelectorAll(o.inputSelector)),c=e.querySelector(o.submitButtonSelector);n(r,c,o),r.forEach((function(a){a.addEventListener("input",(function(){!function(e,n,o){n.validity.valid?t(e,n,o):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,n,n.validationMessage,o)}(e,a,o),n(r,c,o)}))}))}(e,A)}))})();