(()=>{"use strict";function e(e,o){var r=e.querySelector(o.formSelector),c=Array.from(r.querySelectorAll(o.inputSelector)),a=r.querySelector(o.submitButtonSelector);c.forEach((function(e){t(r,e,o)})),n(c,a,o)}var t=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""};function n(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}function o(e){e.classList.add("popup_opened"),e.style.opacity=1,function(e){window.addEventListener("keydown",c),e.addEventListener("mousedown",a)}(e)}function r(){var e,t=function(){var e;return i.forEach((function(t){t.classList.contains("popup_opened")&&(e=t)})),e}();e=t,window.removeEventListener("keydown",c),e.removeEventListener("mousedown",a),t.classList.remove("popup_opened"),t.style.opacity=.3}function c(e){"Escape"===e.key&&r()}function a(e){e.target.classList.contains("popup")&&r(),e.target.classList.contains("popup__close")&&r()}var u={formSelector:".popup__form",inputSelector:".popup__input-text",submitButtonSelector:".popup__save",inactiveButtonClass:"popup__save_inactive",inputErrorClass:"popup__input-text_type_error",errorClass:"popup__input-error_active"},i=document.querySelectorAll(".popup"),l=document.querySelector("#profile-edit-popup"),s=document.querySelector("#card-add-popup"),d=document.querySelector("#image-popup"),f=document.querySelector("#avatar-edit-popup"),p=document.querySelector("#profile-edit-form"),m=document.querySelector("#profile-name-input"),v=document.querySelector("#profile-bio-input"),y=document.querySelector(".profile__name"),_=document.querySelector(".profile__bio"),h=document.querySelector(".profile__image"),S=document.querySelector("#avatar-edit-form"),q=document.querySelector("#avatar-link-input"),E=document.querySelector("#card-add-popup"),L=E.querySelector("#card-place-input"),b=E.querySelector("#card-url-input"),k=d.querySelector(".popup__image"),C=d.querySelector(".popup__caption");function g(e){k.src=e.target.src,k.alt=e.target.alt,C.textContent=e.target.alt,o(d),d.style.background="rgba(0, 0, 0, 0.9)"}var x=document.querySelector(".elements");function w(e,t,n,o){x.prepend(function(e,t,n,o){var r=document.querySelector(".element-template").content.querySelector(".element").cloneNode(!0),c=r.querySelector(".element__image");return r.querySelector(".element__name").textContent=e.name,c.alt=e.name,c.src=e.link,r.querySelector(".element__like-count").textContent=e.likes.length,r.querySelector(".element__like").addEventListener("click",(function(){return o(r,e._id)})),r.querySelector(".element__delete").addEventListener("click",(function(){return n(r,e._id)})),c.addEventListener("click",g),r.dataset._id=e._id,function(e,t,n){e.owner._id===t&&n.querySelector(".element__delete").classList.add("element__delete_active")}(e,t,r),function(e,t,n){e.likes.some((function(e){return e._id===t}))?(B(n),n.dataset.likedByMe=!0):n.dataset.likedByMe=!1}(e,t,r),r}(e,t,n,o))}function B(e){e.querySelector(".element__like").classList.toggle("element__like_active")}var A,U={baseUrl:"https://nomoreparties.co/v1/plus-cohort7",headers:{authorization:"9efb02c5-3a98-4492-ad54-7eb38e1b2fa2","Content-Type":"application/json"}};function T(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function D(e,t,n){var o=e.querySelector(".popup__save");if(t){var r=o.textContent;return o.textContent="Сохранение...",r}o.textContent=n}function M(e,t){(function(e){return fetch("".concat(U.baseUrl,"/cards/").concat(e),{headers:U.headers,method:"DELETE"}).then((function(e){return T(e)}))})(t).then((function(){e.remove()})).catch((function(e){console.log(e)}))}function N(e,t){var n=function(e){return JSON.parse(e.dataset.likedByMe)?"DELETE":"PUT"}(e);(function(e,t){return fetch("".concat(U.baseUrl,"/cards/likes/").concat(e),{headers:U.headers,method:t}).then((function(e){return T(e)}))})(t,n).then((function(t){!function(e,t){e.querySelector(".element__like-count").textContent=t.likes.length}(e,t),e.dataset.likedByMe=!JSON.parse(e.dataset.likedByMe),B(e)})).catch((function(e){console.log(e)}))}window.addEventListener("load",(function(){setTimeout((function(){for(var e=0;e<i.length;e++)i[e].style.display="flex"}),1e3)})),Promise.all([fetch("".concat(U.baseUrl,"/users/me"),{headers:U.headers}).then((function(e){return T(e)})),fetch("".concat(U.baseUrl,"/cards"),{headers:U.headers}).then((function(e){return T(e)}))]).then((function(e){var t=e[0];y.textContent=t.name,_.textContent=t.about,h.src=t.avatar,h.alt=t.name,function(e,t,n,o){e.reverse().forEach((function(e){w(e,t,n,o)}))}(e[1],t._id,M,N)})).catch((function(e){console.log(e)})),p.addEventListener("submit",(function(e){e.preventDefault();var t={name:m.value,about:v.value},n=D(l,!0);(function(e){return fetch("".concat(U.baseUrl,"/users/me"),{headers:U.headers,method:"PATCH",body:JSON.stringify(e)}).then((function(e){return T(e)}))})(t).then((function(e){y.textContent=e.name,_.textContent=e.about,r()})).catch((function(e){console.log(e)})).finally((function(){D(l,!1,n)}))})),E.addEventListener("submit",(function(e){e.preventDefault();var t={name:L.value,link:b.value},n=D(s,!0);(function(e){return fetch("".concat(U.baseUrl,"/cards"),{headers:U.headers,method:"POST",body:JSON.stringify(e)}).then((function(e){return T(e)}))})(t).then((function(e){w(e,e.owner._id,M,N),L.value="",b.value="",r()})).catch((function(e){console.log(e)})).finally((function(){D(s,!1,n)}))})),S.addEventListener("submit",(function(e){e.preventDefault();var t=q.value,n=D(f,!0);(function(e){return fetch("".concat(U.baseUrl,"/users/me/avatar"),{headers:U.headers,method:"PATCH",body:JSON.stringify({avatar:e})}).then((function(e){return T(e)}))})(t).then((function(e){h.src=e.avatar,r()})).catch((function(e){console.log(e)})).finally((function(){D(f,!1,n)}))})),document.querySelector(".profile__add").addEventListener("click",(function(){L.value="",b.value="",e(s,u),o(s)})),document.querySelector(".profile__edit").addEventListener("click",(function(){m.value=y.textContent,v.value=_.textContent,e(l,u),o(l)})),document.querySelector(".profile__avatar").addEventListener("click",(function(){q.value="",e(f,u),o(f)})),A=u,Array.from(document.querySelectorAll(A.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,o){var r=Array.from(e.querySelectorAll(o.inputSelector)),c=e.querySelector(o.submitButtonSelector);n(r,c,o),r.forEach((function(a){a.addEventListener("input",(function(){!function(e,n,o){n.validity.valid?t(e,n,o):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,n,n.validationMessage,o)}(e,a,o),n(r,c,o)}))}))}(e,A)}))})();